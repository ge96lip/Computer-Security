import sys
import base64
from Cryptodome.Cipher import AES

def readall(path):
    with open(path) as f:
        return f.read()



def check(filename):
    
    # Open and read the content of the file
    with open(filename, 'r') as f:
        content = f.readlines()

    # Define virus signatures
    virustxt1 = ''.join(['variable_used_', 'dkajhdskahsdkajdh'])
    virustxt2 = ''.join(['this_is_a_new_var_', 'addsadahdashgdsag'])
    
    # Check for unencrypted virus signatures
    for line in content:
        if virustxt1 in line:
            return 1

        elif virustxt2 in line:
            return 2


    # Check for encrypted content in a specific line
    encoded_key_identifier = 'key = base64.b64decode'
    if len(content) > 3 and encoded_key_identifier in content[3]:
       # Extract and decode the base64-encoded key and payload
        extracted_key = base64.b64decode(content[3][23:].strip())
        encoded_payload = base64.b64decode(content[4][22:].strip())    

        # Decrypt the payload using AES
        decryption_engine = AES.new(extracted_key, mode=AES.MODE_ECB)
        decrypted_content = decryption_engine.decrypt(encoded_payload).decode()

        # Check for virus signatures in the decrypted content
        if virustxt1 in decrypted_content:
            return 1
        if virustxt2 in decrypted_content:
            return 2


    #if no virus detected
    return None
    

if __name__ == '__main__':
    check(sys.argv[1])

